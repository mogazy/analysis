<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحليل فصائل الدم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .gradient-text {
            background-image: linear-gradient(to right, #d000fa, #6d07ba);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Style for reagent sources - now with fixed aspect ratio */
        .reagent-drop-source {
            width: 100%;
            aspect-ratio: 1 / 1; /* This ensures a perfect square shape */
            position: relative;
            border-radius: 50%;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .reagent-drop-source {
            cursor: pointer;
            color: white;
            font-size: 1rem;
            background-color: #3b82f6; /* Default color */
        }
        .reagent-drop-source span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
        }
        .reagent-drop-source:before {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 15px;
            height: 15px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
        }
        /* Style for blood areas container */
        .blood-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        /* Updated styles for a responsive, circular image with smaller border */
        .blood-image {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 50%;
            border: 2px solid #6d07ba; /* Changed border width to 2px */
            object-fit: cover;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            /* Set initial rotation from a custom property */
            transform: rotate(var(--random-rotation, 0deg));
            transition: all 0.3s ease-in-out;
        }
        .agglutination-effect {
            /* Now the animation scales, while preserving the rotation from the custom property */
            animation: pulse 1s infinite alternate;
        }
        /* Modified keyframes to work with the custom property */
        @keyframes pulse {
            from { transform: scale(1) rotate(var(--random-rotation, 0deg)); }
            to { transform: scale(1.1) rotate(var(--random-rotation, 0deg)); }
        }
        .result-text {
            font-size: 1.75rem;
            font-weight: bold;
        }
        .selection-button {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s, color 0.2s;
        }
        .selection-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .selected-button {
            background-color: #6d07ba;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        /* Styles for the arrow buttons */
        .arrow-button {
            width: 48px;
            height: 48px;
            background-color: #6d07ba;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .arrow-button:hover {
            background-color: #8c2ad1;
            transform: translateY(2px);
        }
        .arrow-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="bg-gray-200 p-4 sm:p-8 flex items-center justify-center min-h-screen">
  
              <a href="https://mogazy.github.io/analysis/">
    <header class="fixed top-0 right-0 left-0 z-50 bg-gradient-to-l from-[#d000fa] to-[#6d07ba] text-white p-4 text-center rounded-b-3xl header-intense-shadow">
        <div class="max-w-2xl mx-auto w-full">
            <span class="text-white text-lg font-bold">
                العودة إلى قائمة التحليلات
            </span>
        </div>
    </header>
    </a>
    <style>
                    body {
  margin-top: 80px;
}


        /* تنسيقات الهيدر الجديد */
.header-intense-shadow {
 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
 transition: all 0.3s ease-in-out;
 padding: 1.1rem; /* حجم padding ابتدائي أكبر */
 font-size: 2rem; /* حجم خط ابتدائي أكبر */
 border-bottom-left-radius: 0rem;  
border-bottom-right-radius: 0rem;
}

.header-intense-shadow.scrolled {
box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5);
padding: 1rem; /* حجم padding أصغر عند التمرير */
 font-size: 1rem; /* حجم خط أصغر عند التمرير */
  border-bottom-left-radius: 2rem;  
border-bottom-right-radius: 2rem;
}
</style>
<script>
 document.addEventListener('DOMContentLoaded', () => {
 const header = document.querySelector('header');

 window.addEventListener('scroll', () => {
 if (window.scrollY > 50) { // يمكنك تعديل قيمة 50 لتحديد متى يبدأ التصغير
 header.classList.add('scrolled');
 } else {
 header.classList.remove('scrolled');
 }
 });

 // باقي كود التبويبات (إذا لم تقم بإزالته)
 const ptTab = document.getElementById('pt-tab');
 const pttTab = document.getElementById('ptt-tab');
 const ptContent = document.getElementById('pt-content');
 const pttContent = document.getElementById('ptt-content');

 function setActiveTab(activeTab, inactiveTab, activeContent, inactiveContent) {
 activeTab.classList.add('active');
 activeTab.classList.remove('bg-gray-200', 'text-purple-900');
 activeTab.classList.add('bg-purple-900', 'text-white');

 inactiveTab.classList.remove('active', 'bg-purple-900', 'text-white');
 inactiveTab.classList.add('bg-gray-200', 'text-purple-900');

 activeContent.classList.add('active');
 inactiveContent.classList.remove('active');
 }

 ptTab.addEventListener('click', () => {
 setActiveTab(ptTab, pttTab, ptContent, pttContent);
 });

 pttTab.addEventListener('click', () => {
 setActiveTab(pttTab, ptTab, pttContent, ptContent);
 });

 setActiveTab(ptTab, pttTab, ptContent, pttContent);
 });
            
</script>

   
    
    <!-- A new wrapper div to stack the app and explanation vertically -->
    <div class="flex flex-col items-center w-full max-w-lg">
        <div id="main-container" class="container w-full p-6 sm:p-8 space-y-8">
            <h1 class="text-3xl sm:text-4xl text-center font-extrabold gradient-text">تحليل فصائل الدم</h1>
            
            <p class="text-gray-600 text-center leading-relaxed">
                استكشف كيفية تحديد فصيلة الدم A, B, AB, O عن طريق تفاعل قطرات الدم مع الكواشف (مضاد A, مضاد B, مضاد D). أولاً، اختر فصيلة دم أو قم باختيار عشوائي.
            </p>
            
            <!-- Blood Type Selection -->
            <div id="selection-container" class="p-6 bg-gray-100 rounded-lg space-y-4 text-center">
                <p class="font-bold text-gray-700">اختر فصيلة الدم:</p>
                <div class="flex flex-wrap justify-center gap-2">
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="A">A</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="B">B</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="AB">AB</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="O">O</button>
                </div>
                <div class="flex flex-wrap justify-center gap-2">
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="rh" data-type="+">+</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="rh" data-type="-">-</button>
                </div>
                <button id="random-and-reset-button" class="w-full py-2 px-4 text-white font-bold rounded-lg shadow-lg" style="background-image: linear-gradient(to right, #d000fa, #6d07ba);">
                    اختر فصيلة عشوائياً وابدأ من جديد
                </button>
            </div>

            <!-- Result Display is now below the selection buttons -->
            <div id="result-display" class="blood-type-display mt-8 text-center">
                <span class="text-gray-500">قم بإجراء الاختبار لتحديد الفصيلة</span>
            </div>

            <!-- Reagents Container -->
            <div class="flex justify-center items-center gap-4 mt-8">
                <div id="reagent-a" class="reagent-drop-source" style="background-color: #3b82f6;">
                    <span>مضاد A</span>
                </div>
                <div id="reagent-b" class="reagent-drop-source" style="background-color: #ef4444;">
                    <span>مضاد B</span>
                </div>
                <div id="reagent-rh" class="reagent-drop-source" style="background-color: #10b981;">
                    <span>مضاد D (Rh)</span>
                </div>
            </div>

            <!-- New Arrow Buttons Container -->
            <div class="flex justify-center items-center gap-4 mt-4">
                <button id="drop-a-button" class="arrow-button">
                    <span>↓</span>
                </button>
                <button id="drop-b-button" class="arrow-button">
                    <span>↓</span>
                </button>
                <button id="drop-rh-button" class="arrow-button">
                    <span>↓</span>
                </button>
            </div>

            <!-- Blood Areas Container with Images -->
            <div class="flex justify-center items-start gap-4 mt-4">
                <!-- Added a responsive class 'w-24' to the blood area container to help with scaling -->
                <div id="blood-area-a" class="blood-area w-24" data-reagent="a">
                    <img id="blood-img-a" src="https://envs.sh/FiS.jpg" alt="قطرة دم" class="blood-image">
                    <span id="blood-text-a" class="mt-2 text-gray-600">قطرة دم 1</span>
                </div>
                <div id="blood-area-b" class="blood-area w-24" data-reagent="b">
                    <img id="blood-img-b" src="https://envs.sh/FiS.jpg" alt="قطرة دم" class="blood-image">
                    <span id="blood-text-b" class="mt-2 text-gray-600">قطرة دم 2</span>
                </div>
                <div id="blood-area-rh" class="blood-area w-24" data-reagent="rh">
                    <img id="blood-img-rh" src="https://envs.sh/FiS.jpg" alt="قطرة دم" class="blood-image">
                    <span id="blood-text-rh" class="mt-2 text-gray-600">قطرة دم 3</span>
                </div>
            </div>
        </div>
        
        <!-- The new language note div, added before the explanation div -->
        <div class="container w-full p-6 sm:p-8 space-y-4 mt-8 border border-purple-500" style="background-image: linear-gradient(to bottom right, #e9d5ff, #ffffff);">
            <p class="text-gray-800 leading-relaxed text-right">
                <strong class="text-xl font-bold">ملاحظةٌ لغويةٌ:</strong>
                <br>
                إنَّ لفظَ "تلازُن" هو مصطلحٌ حديثٌ لا أصلَ لهُ في العربيةِ الفصيحةِ، ويُستَخدَمُ في بعضِ السياقاتِ العلميةِ للدلالةِ على التكتُّلِ أو التجمُّعِ، وهو يختلفُ عن لفظِ "تلازم"، الذي يعني الارتباطَ والتقارنَ بينَ شيئينِ لا ينفصلانِ. <span class="font-bold underline">إنَّ قصورَ جهودِ اللغويينَ المعاصرينَ يُسهِمُ في إقحامِ ألفاظٍ لا أصولَ لها في اللغةِ.</span>
            </p>
        </div>
            
        <!-- Explanation div is now a sibling, but inside the new wrapper -->
        <div class="container w-full p-6 sm:p-8 space-y-4 mt-8">
            <h2 class="text-2xl font-bold gradient-text">كيف يعمل تحليل فصيلة الدم؟</h2>
            <p class="text-gray-600 leading-relaxed">
                يتم تحديد فصيلة الدم بناءً على وجود أو غياب مستضدات معينة (بروتينات) على سطح خلايا الدم الحمراء.
                <br>
                في هذا الاختبار، يتم إضافة كواشف مختلفة تحتوي على أجسام مضادة (Anti-A, Anti-B, Anti-D) إلى عينات منفصلة من الدم.
            </p>
            <ul class="list-disc list-inside text-gray-600 leading-relaxed space-y-2">
                <li><strong class="text-gray-800">تفاعل التلازم (Agglutination):</strong> إذا حدث تفاعل (تكتل أو تلازن) فهذا يعني أن مستضد الدم قد تفاعل مع الجسم المضاد في الكاشف. هذا هو ما يحدد نوع الفصيلة.</li>
                <li><strong class="text-gray-800">مضاد A:</strong> يسبب تلازنًا إذا كانت فصيلة الدم تحتوي على المستضد A.</li>
                <li><strong class="text-gray-800">مضاد B:</strong> يسبب تلازنًا إذا كانت فصيلة الدم تحتوي على المستضد B.</li>
                <li><strong class="text-gray-800">مضاد D (Rh):</strong> يسبب تلازنًا إذا كانت فصيلة الدم إيجابية Rh (+).</li>
            </ul>
        </div>
    </div>

    <script>
        // Array of predefined blood types with their reactions
        const bloodTypes = [
            { type: 'A+', a: true, b: false, rh: true, antigen: 'A', rhFactor: '+' },
            { type: 'A-', a: true, b: false, rh: false, antigen: 'A', rhFactor: '-' },
            { type: 'B+', a: false, b: true, rh: true, antigen: 'B', rhFactor: '+' },
            { type: 'B-', a: false, b: true, rh: false, antigen: 'B', rhFactor: '-' },
            { type: 'AB+', a: true, b: true, rh: true, antigen: 'AB', rhFactor: '+' },
            { type: 'AB-', a: true, b: true, rh: false, antigen: 'AB', rhFactor: '-' },
            { type: 'O+', a: false, b: false, rh: true, antigen: 'O', rhFactor: '+' },
            { type: 'O-', a: false, b: false, rh: false, antigen: 'O', rhFactor: '-' }
        ];

        // Global state for the current experiment
        let currentBloodType = null;
        let reactions = {
            a: false,
            b: false,
            rh: false
        };
        let reagentsDropped = {
            a: false,
            b: false,
            rh: false
        };
        const imageNormal = "https://envs.sh/FiS.jpg";
        const imageAgglutination = "https://envs.sh/FiW.jpg";

        // Preload the images to prevent delay
        function preloadImages() {
            const images = [imageNormal, imageAgglutination];
            images.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        }
        
        // Call preload on script load
        preloadImages();

        // DOM elements
        const reagentASource = document.getElementById('reagent-a');
        const reagentBSource = document.getElementById('reagent-b');
        const reagentRhSource = document.getElementById('reagent-rh');
        const bloodImgA = document.getElementById('blood-img-a');
        const bloodImgB = document.getElementById('blood-img-b');
        const bloodImgRh = document.getElementById('blood-img-rh');
        const bloodTextA = document.getElementById('blood-text-a');
        const bloodTextB = document.getElementById('blood-text-b');
        const bloodTextRh = document.getElementById('blood-text-rh');
        const bloodAreaA = document.getElementById('blood-area-a');
        const bloodAreaB = document.getElementById('blood-area-b');
        const bloodAreaRh = document.getElementById('blood-area-rh');
        const resultDisplay = document.getElementById('result-display');
        const randomAndResetButton = document.getElementById('random-and-reset-button');
        const selectionButtons = document.querySelectorAll('.selection-button');

        // Arrow button elements
        const dropAButton = document.getElementById('drop-a-button');
        const dropBButton = document.getElementById('drop-b-button');
        const dropRhButton = document.getElementById('drop-rh-button');

        // Handle blood type selection
        selectionButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const type = e.target.dataset.type;
                const group = e.target.dataset.typeGroup;
                document.querySelectorAll(`.selection-button[data-type-group="${group}"]`).forEach(btn => {
                    btn.classList.remove('selected-button');
                    btn.classList.add('bg-gray-300', 'text-gray-800');
                });
                e.target.classList.add('selected-button');
                e.target.classList.remove('bg-gray-300', 'text-gray-800');
                
                const selectedAntigenBtn = document.querySelector('.selection-button[data-type-group="antigen"].selected-button');
                const selectedRhBtn = document.querySelector('.selection-button[data-type-group="rh"].selected-button');
                
                let selectedAntigen = selectedAntigenBtn ? selectedAntigenBtn.dataset.type : null;
                let selectedRhFactor = selectedRhBtn ? selectedRhBtn.dataset.type : null;
                
                if (selectedAntigen && selectedRhFactor) {
                    currentBloodType = bloodTypes.find(bt => bt.antigen === selectedAntigen && bt.rhFactor === selectedRhFactor);
                    if (currentBloodType) {
                        resultDisplay.innerHTML = `<span class="text-gray-800 fade-in">تم اختيار فصيلة الدم: ${currentBloodType.type}. الآن اضغط على الأسهم.</span>`;
                    }
                    resetExperiment();
                } else {
                    currentBloodType = null;
                    resetExperiment();
                    resultDisplay.innerHTML = `<span class="text-gray-800 fade-in">اختر فصيلة الدم وعامل Rh أولاً.</span>`;
                }
            });
        });

        // Handle random selection and reset
        randomAndResetButton.addEventListener('click', () => {
            resetExperiment();
            const randomIndex = Math.floor(Math.random() * bloodTypes.length);
            currentBloodType = bloodTypes[randomIndex];
            resultDisplay.innerHTML = `<span class="text-gray-800 fade-in">تم اختيار فصيلة الدم عشوائياً. الآن اضغط على الأسهم.</span>`;
            selectionButtons.forEach(btn => {
                btn.classList.remove('selected-button');
                btn.classList.add('bg-gray-300', 'text-gray-800');
            });
        });

        // Function to handle button clicks
        function handleButtonClick(reagentType) {
            if (!currentBloodType) {
                resultDisplay.innerHTML = `<span class="fade-in text-gray-800">الرجاء اختيار فصيلة دم أولاً!</span>`;
                return;
            }

            if (reagentsDropped[reagentType]) {
                return; // Prevent clicking the same button twice
            }

            reagentsDropped[reagentType] = true;
            
            // Get the blood area and image based on the reagent type
            let bloodArea, bloodImg, bloodText;
            switch (reagentType) {
                case 'a':
                    bloodArea = bloodAreaA;
                    bloodImg = bloodImgA;
                    bloodText = bloodTextA;
                    break;
                case 'b':
                    bloodArea = bloodAreaB;
                    bloodImg = bloodImgB;
                    bloodText = bloodTextB;
                    break;
                case 'rh':
                    bloodArea = bloodAreaRh;
                    bloodImg = bloodImgRh;
                    bloodText = bloodTextRh;
                    break;
            }

            simulateReaction(reagentType, bloodArea, bloodImg, bloodText);
        }
        
        // Add event listeners to the new buttons
        dropAButton.addEventListener('click', () => handleButtonClick('a'));
        dropBButton.addEventListener('click', () => handleButtonClick('b'));
        dropRhButton.addEventListener('click', () => handleButtonClick('rh'));

        function simulateReaction(reagentType, bloodArea, bloodImg, bloodText) {
            let isAgglutinated = false;
            switch (reagentType) {
                case 'a':
                    isAgglutinated = currentBloodType.a;
                    reactions.a = isAgglutinated;
                    break;
                case 'b':
                    isAgglutinated = currentBloodType.b;
                    reactions.b = isAgglutinated;
                    break;
                case 'rh':
                    isAgglutinated = currentBloodType.rh;
                    reactions.rh = isAgglutinated;
                    break;
            }

            if (isAgglutinated) {
                // Change image to agglutination state and add effect
                bloodImg.src = imageAgglutination;
                bloodImg.classList.add('agglutination-effect');
                bloodText.textContent = 'تلازن!';
            } else {
                // Change image to normal state and show no agglutination text
                bloodImg.src = imageNormal;
                bloodImg.classList.remove('agglutination-effect');
                bloodText.textContent = 'لا يوجد تلازن';
            }

            // Disable the corresponding arrow button after a click
            let buttonToDisable = null;
            switch(reagentType) {
                case 'a':
                    buttonToDisable = dropAButton;
                    break;
                case 'b':
                    buttonToDisable = dropBButton;
                    break;
                case 'rh':
                    buttonToDisable = dropRhButton;
                    break;
            }
            if(buttonToDisable) {
                buttonToDisable.disabled = true;
            }

            // Check if all reagents have been added and display the final result
            if (reagentsDropped.a && reagentsDropped.b && reagentsDropped.rh) {
                setTimeout(updateResult, 1000);
            } else {
                resultDisplay.innerHTML = `<span class="fade-in text-gray-800">تمت إضافة المضاد بنجاح!</span>`;
            }
        }

        function updateResult() {
            let resultText = '';
            
            // Determine the blood type based on the reactions
            const foundType = bloodTypes.find(type => 
                type.a === reactions.a &&
                type.b === reactions.b &&
                type.rh === reactions.rh
            );
            
            if (foundType) {
                resultText = `فصيلة الدم هي: ${foundType.type}`;
            } else {
                resultText = `لا يمكن تحديد الفصيلة.`;
            }

            resultDisplay.innerHTML = `<span class="fade-in result-text">${resultText}</span>`;
        }
        
        function resetExperiment() {
            // Reset blood areas and images
            bloodImgA.src = imageNormal;
            bloodImgB.src = imageNormal;
            bloodImgRh.src = imageNormal;

            bloodImgA.classList.remove('agglutination-effect');
            bloodImgB.classList.remove('agglutination-effect');
            bloodImgRh.classList.remove('agglutination-effect');
            
            bloodTextA.textContent = 'قطرة دم 1';
            bloodTextB.textContent = 'قطرة دم 2';
            bloodTextRh.textContent = 'قطرة دم 3';
            
            // Reset text and state
            resultDisplay.innerHTML = `<span class="text-gray-500">قم بإجراء الاختبار لتحديد الفصيلة</span>`;
            
            reagentsDropped = { a: false, b: false, rh: false };
            reactions = { a: false, b: false, rh: false };

            // Apply a random rotation to each image on reset using the custom property
            bloodImgA.style.setProperty('--random-rotation', `${Math.random() * 360}deg`);
            bloodImgB.style.setProperty('--random-rotation', `${Math.random() * 360}deg`);
            bloodImgRh.style.setProperty('--random-rotation', `${Math.random() * 360}deg`);
            
            // Enable all arrow buttons
            dropAButton.disabled = false;
            dropBButton.disabled = false;
            dropRhButton.disabled = false;
        }

        // Function to initialize the app
        function initApp() {
            // Automatically select a random blood type
            randomAndResetButton.click();
        }

        window.onload = initApp;
    </script>
</body>
</html>
