<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحليل فصائل الدم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .gradient-text {
            background-image: linear-gradient(to right, #d000fa, #6d07ba);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* Style for reagent sources - now with fixed aspect ratio */
        .reagent-drop-source,
        .blood-area {
            width: 100%;
            aspect-ratio: 1 / 1; /* This ensures a perfect square shape */
            position: relative;
            border-radius: 50%;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .reagent-drop-source {
            cursor: pointer;
            color: white;
            font-size: 1rem;
        }
        .reagent-drop-source span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
        }
        .reagent-drop-source:before {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 15px;
            height: 15px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
        }
        /* Style for blood areas */
        .blood-area {
            background-color: #ef4444; /* Blood color */
            border: 2px dashed #94a3b8;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 1rem;
            flex-wrap: wrap; /* Allows clumps to wrap inside */
        }
        .agglutination-clump {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background-color: #b91c1c;
            opacity: 0.8;
            margin: 2px;
            transition: transform 0.3s ease-in-out;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .agglutination-effect {
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        .shining-border {
            border-color: #d000fa;
            box-shadow: 0 0 15px #d000fa;
        }
        .result-text {
            font-size: 1.75rem; /* Large font size for result */
            font-weight: bold;
        }
        .selection-button {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s, color 0.2s;
        }
        .selection-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .selected-button {
            background-color: #6d07ba;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        /* New styles for the arrow buttons */
        .arrow-button {
            width: 48px;
            height: 48px;
            background-color: #6d07ba;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .arrow-button:hover {
            background-color: #8c2ad1;
            transform: translateY(2px);
        }
        .arrow-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="bg-gray-200 p-4 sm:p-8 flex items-center justify-center min-h-screen">
    
    
    
                <a href="https://mogazy.github.io/analysis/">
    <header class="fixed top-0 right-0 left-0 z-50 bg-gradient-to-l from-[#d000fa] to-[#6d07ba] text-white p-4 text-center rounded-b-3xl header-intense-shadow">
        <div class="max-w-2xl mx-auto w-full">
            <span class="text-white text-lg font-bold">
                العودة إلى قائمة التحليلات
            </span>
        </div>
    </header>
    </a>
    <style>
        body {
  margin-top: 80px;
}


        /* تنسيقات الهيدر الجديد */
.header-intense-shadow {
 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
 transition: all 0.3s ease-in-out;
 padding: 1.1rem; /* حجم padding ابتدائي أكبر */
 font-size: 2rem; /* حجم خط ابتدائي أكبر */
 border-bottom-left-radius: 0rem;  
border-bottom-right-radius: 0rem;
}

.header-intense-shadow.scrolled {
box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5);
padding: 1rem; /* حجم padding أصغر عند التمرير */
 font-size: 1rem; /* حجم خط أصغر عند التمرير */
  border-bottom-left-radius: 2rem;  
border-bottom-right-radius: 2rem;
}
</style>
<script>
 document.addEventListener('DOMContentLoaded', () => {
 const header = document.querySelector('header');

 window.addEventListener('scroll', () => {
 if (window.scrollY > 50) { // يمكنك تعديل قيمة 50 لتحديد متى يبدأ التصغير
 header.classList.add('scrolled');
 } else {
 header.classList.remove('scrolled');
 }
 });

 // باقي كود التبويبات (إذا لم تقم بإزالته)
 const ptTab = document.getElementById('pt-tab');
 const pttTab = document.getElementById('ptt-tab');
 const ptContent = document.getElementById('pt-content');
 const pttContent = document.getElementById('ptt-content');

 function setActiveTab(activeTab, inactiveTab, activeContent, inactiveContent) {
 activeTab.classList.add('active');
 activeTab.classList.remove('bg-gray-200', 'text-purple-900');
 activeTab.classList.add('bg-purple-900', 'text-white');

 inactiveTab.classList.remove('active', 'bg-purple-900', 'text-white');
 inactiveTab.classList.add('bg-gray-200', 'text-purple-900');

 activeContent.classList.add('active');
 inactiveContent.classList.remove('active');
 }

 ptTab.addEventListener('click', () => {
 setActiveTab(ptTab, pttTab, ptContent, pttContent);
 });

 pttTab.addEventListener('click', () => {
 setActiveTab(pttTab, ptTab, pttContent, ptContent);
 });

 setActiveTab(ptTab, pttTab, ptContent, pttContent);
 });
</script>

   
    
    
    
    <!-- A new wrapper div to stack the app and explanation vertically -->
    <div class="flex flex-col items-center w-full max-w-lg">
        <div id="main-container" class="container w-full p-6 sm:p-8 space-y-8">
            <h1 class="text-3xl sm:text-4xl text-center font-extrabold gradient-text">تحليل فصائل الدم</h1>
            
            <p class="text-gray-600 text-center leading-relaxed">
                استكشف كيفية تحديد فصيلة الدم A, B, AB, O عن طريق تفاعل قطرات الدم مع الكواشف (مضاد A, مضاد B, مضاد D). أولاً، اختر فصيلة دم أو قم باختيار عشوائي.
            </p>
            
            <!-- Blood Type Selection -->
            <div id="selection-container" class="p-6 bg-gray-100 rounded-lg space-y-4 text-center">
                <p class="font-bold text-gray-700">اختر فصيلة الدم:</p>
                <div class="flex flex-wrap justify-center gap-2">
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="A">A</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="B">B</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="AB">AB</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="antigen" data-type="O">O</button>
                </div>
                <div class="flex flex-wrap justify-center gap-2">
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="rh" data-type="+">+</button>
                    <button class="selection-button bg-gray-300 text-gray-800" data-type-group="rh" data-type="-">-</button>
                </div>
                <button id="random-and-reset-button" class="w-full py-2 px-4 text-white font-bold rounded-lg shadow-lg" style="background-image: linear-gradient(to right, #d000fa, #6d07ba);">
                    اختر فصيلة عشوائياً وابدأ من جديد
                </button>
            </div>

            <!-- Result Display is now below the selection buttons -->
            <div id="result-display" class="blood-type-display mt-8">
                <span class="text-gray-500">قم بإجراء الاختبار لتحديد الفصيلة</span>
            </div>

            <!-- Reagents Container -->
            <div class="flex justify-center items-center gap-4 mt-8">
                <div id="reagent-a" class="reagent-drop-source" draggable="true" style="background-color: #3b82f6;">
                    <span>مضاد A</span>
                </div>
                <div id="reagent-b" class="reagent-drop-source" draggable="true" style="background-color: #ef4444;">
                    <span>مضاد B</span>
                </div>
                <div id="reagent-rh" class="reagent-drop-source" draggable="true" style="background-color: #10b981;">
                    <span>مضاد D (Rh)</span>
                </div>
            </div>

            <!-- New Arrow Buttons Container (Moved to the requested position) -->
            <div class="flex justify-center items-center gap-4 mt-4">
                <button id="drop-a-button" class="arrow-button">
                    <span>↓</span>
                </button>
                <button id="drop-b-button" class="arrow-button">
                    <span>↓</span>
                </button>
                <button id="drop-rh-button" class="arrow-button">
                    <span>↓</span>
                </button>
            </div>

            <!-- Blood Areas Container -->
            <div class="flex justify-center items-center gap-4 mt-4">
                <div id="blood-area-a" class="blood-area" data-reagent="a">
                    <span>قطرة دم 1</span>
                </div>
                <div id="blood-area-b" class="blood-area" data-reagent="b">
                    <span>قطرة دم 2</span>
                </div>
                <div id="blood-area-rh" class="blood-area" data-reagent="rh">
                    <span>قطرة دم 3</span>
                </div>
            </div>
        </div>
            
        <!-- Explanation div is now a sibling, but inside the new wrapper -->
        <div class="container w-full p-6 sm:p-8 space-y-4 mt-8">
            <h2 class="text-2xl font-bold gradient-text">كيف يعمل تحليل فصيلة الدم؟</h2>
            <p class="text-gray-600 leading-relaxed">
                يتم تحديد فصيلة الدم بناءً على وجود أو غياب مستضدات معينة (بروتينات) على سطح خلايا الدم الحمراء.
                <br>
                في هذا الاختبار، يتم إضافة كواشف مختلفة تحتوي على أجسام مضادة (Anti-A, Anti-B, Anti-D) إلى عينات منفصلة من الدم.
            </p>
            <ul class="list-disc list-inside text-gray-600 leading-relaxed space-y-2">
                <li><strong class="text-gray-800">تفاعل التلازن (Agglutination):</strong> إذا حدث تفاعل (تكتل أو تجلط) فهذا يعني أن مستضد الدم قد تفاعل مع الجسم المضاد في الكاشف. هذا هو ما يحدد نوع الفصيلة.</li>
                <li><strong class="text-gray-800">مضاد A:</strong> يسبب تجلطاً إذا كانت فصيلة الدم تحتوي على المستضد A.</li>
                <li><strong class="text-gray-800">مضاد B:</strong> يسبب تجلطاً إذا كانت فصيلة الدم تحتوي على المستضد B.</li>
                <li><strong class="text-gray-800">مضاد D (Rh):</strong> يسبب تجلطاً إذا كانت فصيلة الدم إيجابية Rh (+).</li>
            </ul>
        </div>
    </div>

    <script>
        // Array of predefined blood types with their reactions
        const bloodTypes = [
            { type: 'A+', a: true, b: false, rh: true, antigen: 'A', rhFactor: '+' },
            { type: 'A-', a: true, b: false, rh: false, antigen: 'A', rhFactor: '-' },
            { type: 'B+', a: false, b: true, rh: true, antigen: 'B', rhFactor: '+' },
            { type: 'B-', a: false, b: true, rh: false, antigen: 'B', rhFactor: '-' },
            { type: 'AB+', a: true, b: true, rh: true, antigen: 'AB', rhFactor: '+' },
            { type: 'AB-', a: true, b: true, rh: false, antigen: 'AB', rhFactor: '-' },
            { type: 'O+', a: false, b: false, rh: true, antigen: 'O', rhFactor: '+' },
            { type: 'O-', a: false, b: false, rh: false, antigen: 'O', rhFactor: '-' }
        ];

        // Global state for the current experiment
        let currentBloodType = null;
        let reactions = {
            a: false,
            b: false,
            rh: false
        };
        let reagentsDropped = {
            a: false,
            b: false,
            rh: false
        };

        const reagentASource = document.getElementById('reagent-a');
        const reagentBSource = document.getElementById('reagent-b');
        const reagentRhSource = document.getElementById('reagent-rh');
        const bloodAreaA = document.getElementById('blood-area-a');
        const bloodAreaB = document.getElementById('blood-area-b');
        const bloodAreaRh = document.getElementById('blood-area-rh');
        const resultDisplay = document.getElementById('result-display');
        const randomAndResetButton = document.getElementById('random-and-reset-button');
        const selectionButtons = document.querySelectorAll('.selection-button');

        // New button elements
        const dropAButton = document.getElementById('drop-a-button');
        const dropBButton = document.getElementById('drop-b-button');
        const dropRhButton = document.getElementById('drop-rh-button');

        // Added variables to support touch drag and drop
        let draggedElement = null;

        // Function to create a new blood drop (this function is no longer used, but kept for clarity)
        function createAgglutinationClump(color) {
            const clump = document.createElement('div');
            clump.classList.add('agglutination-clump');
            clump.style.backgroundColor = color;
            return clump;
        }

        // Handle blood type selection
        selectionButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                // Get the type and group from the clicked button
                const type = e.target.dataset.type;
                const group = e.target.dataset.typeGroup;

                // Reset only the selection for the current group
                document.querySelectorAll(`.selection-button[data-type-group="${group}"]`).forEach(btn => {
                    btn.classList.remove('selected-button');
                    btn.classList.add('bg-gray-300', 'text-gray-800');
                });
                
                // Set the selected class for the clicked button
                e.target.classList.add('selected-button');
                e.target.classList.remove('bg-gray-300', 'text-gray-800');
                
                // Get the currently selected buttons from both groups
                const selectedAntigenBtn = document.querySelector('.selection-button[data-type-group="antigen"].selected-button');
                const selectedRhBtn = document.querySelector('.selection-button[data-type-group="rh"].selected-button');
                
                let selectedAntigen = selectedAntigenBtn ? selectedAntigenBtn.dataset.type : null;
                let selectedRhFactor = selectedRhBtn ? selectedRhBtn.dataset.type : null;
                
                // Find the blood type based on the combined selection
                if (selectedAntigen && selectedRhFactor) {
                    currentBloodType = bloodTypes.find(bt => bt.antigen === selectedAntigen && bt.rhFactor === selectedRhFactor);
                    if (currentBloodType) {
                        resultDisplay.innerHTML = `<span class="text-gray-800 fade-in">تم اختيار فصيلة الدم: ${currentBloodType.type}. الآن اسحب الكواشف.</span>`;
                    }
                    
                    // Reset experiment state if a new type is selected
                    resetExperiment();
                } else {
                    // If only one part is selected, reset experiment state without picking a blood type
                    currentBloodType = null;
                    resetExperiment();
                    resultDisplay.innerHTML = `<span class="text-gray-800 fade-in">اختر فصيلة الدم وعامل Rh أولاً.</span>`;
                }
            });
        });

        // Handle random selection and reset
        randomAndResetButton.addEventListener('click', () => {
            resetExperiment();
            const randomIndex = Math.floor(Math.random() * bloodTypes.length);
            currentBloodType = bloodTypes[randomIndex];
            resultDisplay.innerHTML = `<span class="text-gray-800 fade-in">تم اختيار فصيلة الدم عشوائياً. الآن اسحب الكواشف.</span>`;
            
            // Remove selection state from all selection buttons
            selectionButtons.forEach(btn => {
                btn.classList.remove('selected-button');
                btn.classList.add('bg-gray-300', 'text-gray-800');
            });
        });

        // Drag and Drop Functions (now support touch)
        // Function to handle the drag start event for reagents (Mouse)
        document.querySelectorAll('.reagent-drop-source').forEach(reagent => {
            reagent.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.id.split('-')[1]);
                e.target.style.opacity = '0.7';
            });
            reagent.addEventListener('dragend', (e) => {
                e.target.style.opacity = '1';
            });
        });

        // Function to handle touch start for dragging (Mobile)
        document.querySelectorAll('.reagent-drop-source').forEach(reagent => {
            reagent.addEventListener('touchstart', (e) => {
                e.preventDefault();
                draggedElement = e.target;
                draggedElement.style.opacity = '0.7';
                draggedElement.style.transition = 'none'; // Disable transition during drag
                draggedElement.style.position = 'fixed';
            });
        });

        // Function to handle touch move (Mobile)
        document.body.addEventListener('touchmove', (e) => {
            if (draggedElement) {
                e.preventDefault();
                const touch = e.touches[0];
                draggedElement.style.left = `${touch.clientX - draggedElement.offsetWidth / 2}px`;
                draggedElement.style.top = `${touch.clientY - draggedElement.offsetHeight / 2}px`;

                // Highlight drop areas on hover
                document.querySelectorAll('.blood-area').forEach(area => {
                    const rect = area.getBoundingClientRect();
                    if (
                        touch.clientX > rect.left && touch.clientX < rect.right &&
                        touch.clientY > rect.top && touch.clientY < rect.bottom
                    ) {
                        area.classList.add('shining-border');
                    } else {
                        area.classList.remove('shining-border');
                    }
                });
            }
        });

        // Function to handle touch end (Mobile)
        document.body.addEventListener('touchend', (e) => {
            if (draggedElement) {
                const touch = e.changedTouches[0];
                let dropped = false;

                document.querySelectorAll('.blood-area').forEach(area => {
                    area.classList.remove('shining-border');
                    const rect = area.getBoundingClientRect();
                    if (
                        touch.clientX > rect.left && touch.clientX < rect.right &&
                        touch.clientY > rect.top && touch.clientY < rect.bottom
                    ) {
                        // Simulate a drop event
                        const reagentType = draggedElement.id.split('-')[1];
                        const targetReagent = area.dataset.reagent;
                        if (reagentType === targetReagent) {
                            handleDropManual(reagentType, area);
                            dropped = true;
                        }
                    }
                });

                // Reset element position and state
                draggedElement.style.position = 'static';
                draggedElement.style.transform = 'none';
                draggedElement.style.opacity = '1';
                draggedElement.style.left = '';
                draggedElement.style.top = '';
                draggedElement = null;
            }
        });

        // Function to handle the dragover event on the blood areas (Mouse)
        document.querySelectorAll('.blood-area').forEach(area => {
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('shining-border');
            });
            area.addEventListener('dragleave', (e) => {
                area.classList.remove('shining-border');
            });
            area.addEventListener('drop', handleDrop);
        });

        // Function to handle the drop event (Mouse)
        function handleDrop(e) {
            e.preventDefault();
            const bloodArea = e.currentTarget;
            const reagentType = e.dataTransfer.getData('text/plain');
            const targetReagent = bloodArea.dataset.reagent;

            bloodArea.classList.remove('shining-border');

            if (reagentType !== targetReagent || reagentsDropped[reagentType]) {
                return;
            }
            
            reagentsDropped[reagentType] = true;
            const reagentSource = document.getElementById('reagent-' + reagentType);
            reagentSource.style.opacity = '0.5';
            reagentSource.style.cursor = 'not-allowed';

            // Simulate the reaction
            simulateReaction(reagentType, bloodArea);
        }

        // Function to handle drop event from touch (Manual)
        function handleDropManual(reagentType, bloodArea) {
            if (reagentsDropped[reagentType]) {
                return;
            }

            reagentsDropped[reagentType] = true;
            const reagentSource = document.getElementById('reagent-' + reagentType);
            reagentSource.style.opacity = '0.5';
            reagentSource.style.cursor = 'not-allowed';
            
            // Simulate the reaction
            simulateReaction(reagentType, bloodArea);
        }

        // New function to handle button clicks
        function handleButtonClick(reagentType) {
            let bloodArea;
            switch (reagentType) {
                case 'a':
                    bloodArea = bloodAreaA;
                    break;
                case 'b':
                    bloodArea = bloodAreaB;
                    break;
                case 'rh':
                    bloodArea = bloodAreaRh;
                    break;
            }
            handleDropManual(reagentType, bloodArea);
        }
        
        // Add event listeners to the new buttons
        dropAButton.addEventListener('click', () => handleButtonClick('a'));
        dropBButton.addEventListener('click', () => handleButtonClick('b'));
        dropRhButton.addEventListener('click', () => handleButtonClick('rh'));

        function simulateReaction(reagentType, bloodArea) {
            // Check if a blood type has been selected before proceeding
            if (!currentBloodType) {
                resultDisplay.innerHTML = `<span class="fade-in text-gray-800">الرجاء اختيار فصيلة دم أولاً!</span>`;
                // Reset the dropped reagent state since we didn't process it
                reagentsDropped[reagentType] = false;
                const reagentSource = document.getElementById('reagent-' + reagentType);
                reagentSource.style.opacity = '1';
                reagentSource.style.cursor = 'pointer';
                return;
            }
            
            let isAgglutinated = false;
            switch (reagentType) {
                case 'a':
                    isAgglutinated = currentBloodType.a;
                    reactions.a = isAgglutinated;
                    break;
                case 'b':
                    isAgglutinated = currentBloodType.b;
                    reactions.b = isAgglutinated;
                    break;
                case 'rh':
                    isAgglutinated = currentBloodType.rh;
                    reactions.rh = isAgglutinated;
                    break;
            }

            if (isAgglutinated) {
                // Clear the content and insert the "Agglutination" text
                bloodArea.innerHTML = '';
                const textSpan = document.createElement('span');
                textSpan.classList.add('text-white', 'text-center', 'font-bold', 'text-lg', 'absolute', 'top-1/2', 'left-1/2', '-translate-x-1/2', '-translate-y-1/2');
                textSpan.textContent = 'تجلط!';
                bloodArea.appendChild(textSpan);

                // Add the pulsing effect to the blood area
                bloodArea.classList.add('agglutination-effect');
            } else {
                // If no agglutination, just keep the original state and add a message
                bloodArea.innerHTML = `<span class="text-white text-center font-bold text-lg absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2">لا يوجد تجلط</span>`;
            }

            // Check if all reagents have been dropped and display the final result
            if (reagentsDropped.a && reagentsDropped.b && reagentsDropped.rh) {
                setTimeout(updateResult, 1000);
            } else if (reagentsDropped.a || reagentsDropped.b || reagentsDropped.rh) {
                resultDisplay.innerHTML = `<span class="fade-in text-gray-800">تمت إضافة المضاد بنجاح!</span>`;
            }
        }

        function updateResult() {
            let resultText = '';
            
            // Determine the blood type based on the reactions
            const foundType = bloodTypes.find(type => 
                type.a === reactions.a &&
                type.b === reactions.b &&
                type.rh === reactions.rh
            );
            
            if (foundType) {
                resultText = `فصيلة الدم هي: ${foundType.type}`;
            } else {
                resultText = `لا يمكن تحديد الفصيلة.`;
            }

            resultDisplay.innerHTML = `<span class="fade-in result-text">${resultText}</span>`;
        }
        
        function resetExperiment() {
            // Reset blood areas
            bloodAreaA.innerHTML = `<span>قطرة دم 1</span>`;
            bloodAreaB.innerHTML = `<span>قطرة دم 2</span>`;
            bloodAreaRh.innerHTML = `<span>قطرة دم 3</span>`;

            bloodAreaA.classList.remove('agglutination-effect');
            bloodAreaB.classList.remove('agglutination-effect');
            bloodAreaRh.classList.remove('agglutination-effect');
            
            // Reset styles
            bloodAreaA.style.backgroundColor = '#ef4444';
            bloodAreaB.style.backgroundColor = '#ef4444';
            bloodAreaRh.style.backgroundColor = '#ef4444';

            bloodAreaA.style.border = '2px dashed #94a3b8';
            bloodAreaB.style.border = '2px dashed #94a3b8';
            bloodAreaRh.style.border = '2px dashed #94a3b8';
            
            // Reset text and state
            resultDisplay.innerHTML = `<span class="text-gray-500">قم بإجراء الاختبار لتحديد الفصيلة</span>`;
            
            reagentsDropped = { a: false, b: false, rh: false };
            reactions = { a: false, b: false, rh: false };

            // Reset reagent source opacity and cursor
            reagentASource.style.opacity = '1';
            reagentBSource.style.opacity = '1';
            reagentRhSource.style.opacity = '1';
            reagentASource.draggable = true;
            reagentBSource.draggable = true;
            reagentRhSource.draggable = true;
        }

        // Function to initialize the app
        function initApp() {
            // Automatically select a random blood type
            randomAndResetButton.click();
        }

        window.onload = initApp;
        
    </script>
</body>
</html>
