<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار فصائل الدم</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f0f0f0;
        }
        .container {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .gradient-text {
            background-image: linear-gradient(to right, #d000fa, #6d07ba);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .reagent-drop-source {
            width: 100%;
            aspect-ratio: 1 / 1;
            position: relative;
            border-radius: 50%;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        .reagent-drop-source {
            cursor: pointer;
            color: white;
            font-size: 1rem;
            background-color: #3b82f6;
        }
        .reagent-drop-source span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            white-space: nowrap;
        }
        .reagent-drop-source:before {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 15px;
            height: 15px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50%;
        }
        .blood-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .blood-image {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 50%;
            border: 2px solid #6d07ba;
            object-fit: cover;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: rotate(var(--random-rotation, 0deg));
            transition: all 0.3s ease-in-out;
        }
        .agglutination-effect {
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            from { transform: scale(1) rotate(var(--random-rotation, 0deg)); }
            to { transform: scale(1.1) rotate(var(--random-rotation, 0deg)); }
        }
        .result-text {
            font-size: 1.75rem;
            font-weight: bold;
        }
        .selection-button, .guess-button {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s, color 0.2s;
        }
        .selection-button:hover, .guess-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .selected-button {
            background-color: #6d07ba;
            color: white;
            box-shadow: 0 44px 6px rgba(0, 0, 0, 0.1);
        }
        .arrow-button {
            width: 48px;
            height: 48px;
            background-color: #6d07ba;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .arrow-button:hover {
            background-color: #8c2ad1;
            transform: translateY(2px);
        }
        .arrow-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .correct-guess {
            background-color: #22c55e;
            color: white;
        }
        .incorrect-guess {
            background-color: #ef4444;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-200 p-4 sm:p-8 flex items-center justify-center min-h-screen">
                <a href="https://mogazy.github.io/analysis/">
    <header class="fixed top-0 right-0 left-0 z-50 bg-gradient-to-l from-[#d000fa] to-[#6d07ba] text-white p-4 text-center rounded-b-3xl header-intense-shadow">
        <div class="max-w-2xl mx-auto w-full">
            <span class="text-white text-lg font-bold">
                العودة إلى قائمة التحليلات
            </span>
        </div>
    </header>
    </a>
    <style>
                    body {
  margin-top: 80px;
}


        /* تنسيقات الهيدر الجديد */
.header-intense-shadow {
 box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
 transition: all 0.3s ease-in-out;
 padding: 1.1rem; /* حجم padding ابتدائي أكبر */
 font-size: 2rem; /* حجم خط ابتدائي أكبر */
 border-bottom-left-radius: 0rem;  
border-bottom-right-radius: 0rem;
}

.header-intense-shadow.scrolled {
box-shadow: 0 6px 10px rgba(0, 0, 0, 0.5);
padding: 1rem; /* حجم padding أصغر عند التمرير */
 font-size: 1rem; /* حجم خط أصغر عند التمرير */
  border-bottom-left-radius: 2rem;  
border-bottom-right-radius: 2rem;
}
</style>
<script>
 document.addEventListener('DOMContentLoaded', () => {
 const header = document.querySelector('header');

 window.addEventListener('scroll', () => {
 if (window.scrollY > 50) { // يمكنك تعديل قيمة 50 لتحديد متى يبدأ التصغير
 header.classList.add('scrolled');
 } else {
 header.classList.remove('scrolled');
 }
 });

 // باقي كود التبويبات (إذا لم تقم بإزالته)
 const ptTab = document.getElementById('pt-tab');
 const pttTab = document.getElementById('ptt-tab');
 const ptContent = document.getElementById('pt-content');
 const pttContent = document.getElementById('ptt-content');

 function setActiveTab(activeTab, inactiveTab, activeContent, inactiveContent) {
 activeTab.classList.add('active');
 activeTab.classList.remove('bg-gray-200', 'text-purple-900');
 activeTab.classList.add('bg-purple-900', 'text-white');

 inactiveTab.classList.remove('active', 'bg-purple-900', 'text-white');
 inactiveTab.classList.add('bg-gray-200', 'text-purple-900');

 activeContent.classList.add('active');
 inactiveContent.classList.remove('active');
 }

 ptTab.addEventListener('click', () => {
 setActiveTab(ptTab, pttTab, ptContent, pttContent);
 });

 pttTab.addEventListener('click', () => {
 setActiveTab(pttTab, ptTab, pttContent, ptContent);
 });

 setActiveTab(ptTab, pttTab, ptContent, pttContent);
 });
            
</script>

   
    <div class="flex flex-col items-center w-full max-w-lg">
        
        <!-- New div for the main title and description -->
        <div class="container w-full p-6 sm:p-8 space-y-4 text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold gradient-text">اختبار فصائل الدم</h1>
            <p class="text-gray-600 leading-relaxed">
                يُحدد هذا الاختبار فصيلة الدم من خلال التفاعلات بين الأجسام المضادة والمستضدات على سطح خلايا الدم الحمراء.
            </p>
        </div>
        
        <!-- The main interactive section is now below the new title div -->
        <div id="main-container" class="container w-full p-6 sm:p-8 space-y-8 mt-8">
            
            <!-- Score Display -->
            <div id="score-display" class="p-4 bg-gray-100 rounded-lg text-center">
                <span class="text-gray-700 font-bold">النتيجة: </span>
                <span id="current-score" class="text-2xl font-bold gradient-text">0</span>
                <span id="total-games" class="text-xs text-gray-500">/ 0</span>
            </div>

            <!-- This div contains the game status text and has been moved -->
            <p id="game-status-text" class="text-gray-600 text-center leading-relaxed">
                استخدم الأسهم لإسقاط الكواشف على قطرات الدم.
            </p>
            
            <!-- Reagents Container -->
            <div class="flex justify-center items-center gap-4 mt-8">
                <div id="reagent-a" class="reagent-drop-source" style="background-color: #3b82f6;">
                    <span>مضاد A</span>
                </div>
                <div id="reagent-b" class="reagent-drop-source" style="background-color: #ef4444;">
                    <span>مضاد B</span>
                </div>
                <div id="reagent-rh" class="reagent-drop-source" style="background-color: #10b981;">
                    <span>مضاد D (Rh)</span>
                </div>
            </div>

            <!-- Arrow Buttons Container -->
            <div class="flex justify-center items-center gap-4 mt-4">
                <button id="drop-a-button" class="arrow-button">
                    <span>↓</span>
                </button>
                <button id="drop-b-button" class="arrow-button">
                    <span>↓</span>
                </button>
                <button id="drop-rh-button" class="arrow-button">
                    <span>↓</span>
                </button>
            </div>

            <!-- Blood Areas Container with Images -->
            <div class="flex justify-center items-start gap-4 mt-4">
                <div id="blood-area-a" class="blood-area w-24" data-reagent="a">
                    <img id="blood-img-a" src="https://raw.githubusercontent.com/mogazy/Almaktba/refs/heads/main/%D9%82%D8%B7%D8%B1%D8%A9%20%D8%AF%D9%85.jpg" alt="قطرة دم" class="blood-image">
                    <span id="blood-text-a" class="mt-2 text-gray-600">قطرة دم 1</span>
                </div>
                <div id="blood-area-b" class="blood-area w-24" data-reagent="b">
                    <img id="blood-img-b" src="https://raw.githubusercontent.com/mogazy/Almaktba/refs/heads/main/%D9%82%D8%B7%D8%B1%D8%A9%20%D8%AF%D9%85.jpg" alt="قطرة دم" class="blood-image">
                    <span id="blood-text-b" class="mt-2 text-gray-600">قطرة دم 2</span>
                </div>
                <div id="blood-area-rh" class="blood-area w-24" data-reagent="rh">
                    <img id="blood-img-rh" src="https://raw.githubusercontent.com/mogazy/Almaktba/refs/heads/main/%D9%82%D8%B7%D8%B1%D8%A9%20%D8%AF%D9%85.jpg" alt="قطرة دم" class="blood-image">
                    <span id="blood-text-rh" class="mt-2 text-gray-600">قطرة دم 3</span>
                </div>
            </div>

            <!-- Guessing Section -->
            <div id="guess-section" class="p-6 bg-gray-100 rounded-lg space-y-4 text-center hidden">
                <p class="font-bold text-gray-700">اختر فصيلة الدم:</p>
                <div class="flex flex-wrap justify-center gap-2">
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="A+">A+</button>
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="A-">A-</button>
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="B+">B+</button>
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="B-">B-</button>
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="AB+">AB+</button>
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="AB-">AB-</button>
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="O+">O+</button>
                    <button class="guess-button bg-gray-300 text-gray-800" data-type="O-">O-</button>
                </div>
                <p id="guess-feedback" class="font-bold text-lg"></p>
            </div>
        </div>

        <!-- The language note div is still in its place -->
        <div class="container w-full p-6 sm:p-8 space-y-4 mt-8 border border-purple-500" style="background-image: linear-gradient(to bottom right, #e9d5ff, #ffffff);">
            <p class="text-gray-800 leading-relaxed text-right">
                <strong class="text-xl font-bold">ملاحظةٌ لغويةٌ:</strong>
                <br>
                إنَّ لفظَ "تلازُن" هو مصطلحٌ حديثٌ لا أصلَ لهُ في العربيةِ الفصيحةِ، ويُستَخدَمُ في بعضِ السياقاتِ العلميةِ للدلالةِ على التكتُّلِ أو التجمُّعِ، وهو يختلفُ عن لفظِ "تلازم"، الذي يعني الارتباطَ والتقارنَ بينَ شيئينِ لا ينفصلانِ. <span class="font-bold underline">إنَّ قصورَ جهودِ اللغويينَ المعاصرينَ يُسهِمُ في إقحامِ ألفاظٍ لا أصولَ لها في اللغةِ.</span>
            </p>
        </div>
        
        <!-- Explanation text is now at the very bottom -->
        <div class="container w-full p-6 sm:p-8 space-y-4 mt-8">
            <h2 class="text-2xl font-bold gradient-text">كيف يعمل تحليل فصيلة الدم؟</h2>
            <p class="text-gray-600 leading-relaxed">
                يتم تحديد فصيلة الدم بناءً على وجود أو غياب مستضدات معينة (بروتينات) على سطح خلايا الدم الحمراء.
                في هذا الاختبار، يتم إضافة كواشف مختلفة تحتوي على أجسام مضادة (Anti-A, Anti-B, Anti-D) إلى عينات منفصلة من الدم.
            </p>
            <ul class="list-disc list-inside text-gray-600 leading-relaxed space-y-2">
                <li><strong class="text-gray-800">تفاعل التلازم (Agglutination):</strong> إذا حدث تفاعل (تكتل أو تلازن) فهذا يعني أن مستضد الدم قد تفاعل مع الجسم المضاد في الكاشف. هذا هو ما يحدد نوع الفصيلة.</li>
                <li><strong class="text-gray-800">مضاد A:</strong> يسبب تلازنًا إذا كانت فصيلة الدم تحتوي على المستضد A.</li>
                <li><strong class="text-gray-800">مضاد B:</strong> يسبب تلازنًا إذا كانت فصيلة الدم تحتوي على المستضد B.</li>
                <li><strong class="text-gray-800">مضاد D (Rh):</strong> يسبب تلازنًا إذا كانت فصيلة الدم إيجابية Rh (+).</li>
            </ul>
        </div>
    </div>

    <script>
        // Array of predefined blood types with their reactions
        const bloodTypes = [
            { type: 'A+', a: true, b: false, rh: true, antigen: 'A', rhFactor: '+' },
            { type: 'A-', a: true, b: false, rh: false, antigen: 'A', rhFactor: '-' },
            { type: 'B+', a: false, b: true, rh: true, antigen: 'B', rhFactor: '+' },
            { type: 'B-', a: false, b: true, rh: false, antigen: 'B', rhFactor: '-' },
            { type: 'AB+', a: true, b: true, rh: true, antigen: 'AB', rhFactor: '+' },
            { type: 'AB-', a: true, b: true, rh: false, antigen: 'AB', rhFactor: '-' },
            { type: 'O+', a: false, b: false, rh: true, antigen: 'O', rhFactor: '+' },
            { type: 'O-', a: false, b: false, rh: false, antigen: 'O', rhFactor: '-' }
        ];

        // Global state for the game
        let currentBloodType = null;
        let reactions = {
            a: false,
            b: false,
            rh: false
        };
        let reagentsDropped = {
            a: false,
            b: false,
            rh: false
        };
        let correctGuesses = 0; // Renamed score to correctGuesses for clarity
        let totalGames = 0;
        const imageNormal = "https://raw.githubusercontent.com/mogazy/Almaktba/refs/heads/main/%D9%82%D8%B7%D8%B1%D8%A9%20%D8%AF%D9%85.jpg";
        const imageAgglutination = "https://raw.githubusercontent.com/mogazy/Almaktba/refs/heads/main/%D8%AA%D9%84%D8%A7%D8%B2%D9%86.jpg";

        // Preload the images to prevent delay
        function preloadImages() {
            const images = [imageNormal, imageAgglutination];
            images.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        }
        
        // DOM elements
        const bloodImgA = document.getElementById('blood-img-a');
        const bloodImgB = document.getElementById('blood-img-b');
        const bloodImgRh = document.getElementById('blood-img-rh');
        const bloodTextA = document.getElementById('blood-text-a');
        const bloodTextB = document.getElementById('blood-text-b');
        const bloodTextRh = document.getElementById('blood-text-rh');
        const gameStatusText = document.getElementById('game-status-text');
        const scoreDisplay = document.getElementById('current-score');
        const totalGamesDisplay = document.getElementById('total-games');
        const guessSection = document.getElementById('guess-section');
        const guessButtons = document.querySelectorAll('.guess-button');
        const guessFeedback = document.getElementById('guess-feedback');
        const dropAButton = document.getElementById('drop-a-button');
        const dropBButton = document.getElementById('drop-b-button');
        const dropRhButton = document.getElementById('drop-rh-button');
        
        // Initially disable all action buttons until a new round starts
        function toggleGameControls(enabled) {
            dropAButton.disabled = !enabled;
            dropBButton.disabled = !enabled;
            dropRhButton.disabled = !enabled;
        }
        
        // Function to update the score display
        function updateScoreDisplay() {
            scoreDisplay.textContent = correctGuesses;
            totalGamesDisplay.textContent = `/ ${totalGames}`;
        }

        function startTest() {
            totalGames++;
            updateScoreDisplay();
            toggleGameControls(true);
            resetExperiment();
            const randomIndex = Math.floor(Math.random() * bloodTypes.length);
            currentBloodType = bloodTypes[randomIndex];
            gameStatusText.textContent = 'استخدم الأسهم لإسقاط الكواشف على قطرات الدم.';
        }

        function handleButtonClick(reagentType) {
            if (!currentBloodType) {
                gameStatusText.textContent = 'الرجاء الضغط على "ابدأ جولة جديدة" لبدء الاختبار.';
                return;
            }

            if (reagentsDropped[reagentType]) {
                return;
            }

            reagentsDropped[reagentType] = true;
            
            let bloodImg, bloodText;
            switch (reagentType) {
                case 'a':
                    bloodImg = bloodImgA;
                    bloodText = bloodTextA;
                    break;
                case 'b':
                    bloodImg = bloodImgB;
                    bloodText = bloodTextB;
                    break;
                case 'rh':
                    bloodImg = bloodImgRh;
                    bloodText = bloodTextRh;
                    break;
            }

            simulateReaction(reagentType, bloodImg, bloodText);
        }
        
        function simulateReaction(reagentType, bloodImg, bloodText) {
            let isAgglutinated = false;
            switch (reagentType) {
                case 'a':
                    isAgglutinated = currentBloodType.a;
                    reactions.a = isAgglutinated;
                    dropAButton.disabled = true;
                    break;
                case 'b':
                    isAgglutinated = currentBloodType.b;
                    reactions.b = isAgglutinated;
                    dropBButton.disabled = true;
                    break;
                case 'rh':
                    isAgglutinated = currentBloodType.rh;
                    reactions.rh = isAgglutinated;
                    dropRhButton.disabled = true;
                    break;
            }

            if (isAgglutinated) {
                bloodImg.src = imageAgglutination;
                bloodImg.classList.add('agglutination-effect');
                bloodText.textContent = 'تلازن!';
            } else {
                bloodImg.src = imageNormal;
                bloodImg.classList.remove('agglutination-effect');
                bloodText.textContent = 'لا يوجد تلازن';
            }

            gameStatusText.textContent = 'تمت إضافة الكاشف بنجاح! أكمل الاختبار.';

            if (reagentsDropped.a && reagentsDropped.b && reagentsDropped.rh) {
                setTimeout(() => {
                    gameStatusText.textContent = 'التحليل كامل! قم بتخمين فصيلة الدم.';
                    guessSection.classList.remove('hidden');
                    toggleGameControls(false);
                }, 1000);
            }
        }

        function handleGuess(e) {
            const guessedType = e.target.dataset.type;
            const isCorrect = guessedType === currentBloodType.type;

            // Remove previous classes from all buttons
            guessButtons.forEach(button => {
                button.classList.remove('correct-guess', 'incorrect-guess');
                button.classList.add('bg-gray-300', 'text-gray-800');
            });

            if (isCorrect) {
                correctGuesses++;
                updateScoreDisplay();
                guessFeedback.textContent = `إجابتك صحيحة! فصيلة الدم هي: ${currentBloodType.type}`;
                guessFeedback.classList.remove('incorrect-guess');
                guessFeedback.classList.add('correct-guess');
                e.target.classList.remove('bg-gray-300', 'text-gray-800'); // Remove default class
                e.target.classList.add('correct-guess'); // Add green class
            } else {
                guessFeedback.textContent = `إجابتك خاطئة. فصيلة الدم الصحيحة هي: ${currentBloodType.type}`;
                guessFeedback.classList.remove('correct-guess');
                guessFeedback.classList.add('incorrect-guess');
                e.target.classList.remove('bg-gray-300', 'text-gray-800'); // Remove default class
                e.target.classList.add('incorrect-guess'); // Add red class
                
                // Highlight the correct answer as well
                const correctButton = document.querySelector(`[data-type="${currentBloodType.type}"]`);
                if (correctButton) {
                     correctButton.classList.remove('bg-gray-300', 'text-gray-800');
                     correctButton.classList.add('correct-guess');
                }
            }
            
            // Disable all guess buttons after a guess is made
            guessButtons.forEach(button => button.disabled = true);
            
            // Automatically start a new round after a delay
            setTimeout(startTest, 3000);
        }

        function resetExperiment() {
            bloodImgA.src = imageNormal;
            bloodImgB.src = imageNormal;
            bloodImgRh.src = imageNormal;

            bloodImgA.classList.remove('agglutination-effect');
            bloodImgB.classList.remove('agglutination-effect');
            bloodImgRh.classList.remove('agglutination-effect');
            
            bloodTextA.textContent = 'قطرة دم 1';
            bloodTextB.textContent = 'قطرة دم 2';
            bloodTextRh.textContent = 'قطرة دم 3';
            
            reagentsDropped = { a: false, b: false, rh: false };
            reactions = { a: false, b: false, rh: false };
            currentBloodType = null;
            
            bloodImgA.style.setProperty('--random-rotation', `${Math.random() * 360}deg`);
            bloodImgB.style.setProperty('--random-rotation', `${Math.random() * 360}deg`);
            bloodImgRh.style.setProperty('--random-rotation', `${Math.random() * 360}deg`);
            
            guessSection.classList.add('hidden');
            guessFeedback.textContent = '';
            guessButtons.forEach(button => {
                button.disabled = false;
                button.classList.remove('correct-guess', 'incorrect-guess');
                button.classList.add('bg-gray-300', 'text-gray-800');
            });
        }
        
        // Event listeners
        dropAButton.addEventListener('click', () => handleButtonClick('a'));
        dropBButton.addEventListener('click', () => handleButtonClick('b'));
        dropRhButton.addEventListener('click', () => handleButtonClick('rh'));
        guessButtons.forEach(button => {
            button.addEventListener('click', handleGuess);
        });

        // Initialize on page load
        window.onload = function() {
            preloadImages();
            startTest();
        };

    </script>
</body>
</html>
